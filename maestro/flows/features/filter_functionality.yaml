# Feature Flow: Filter Functionality
# Tests filter page with category and district selection

appId: ${APP_ID}
---

# Verify filter view is open
- assertVisible:
    id: "filter_view"
- takeScreenshot: "filter_view_opened"

# Wait for categories to load
- wait:
    notVisible:
      id: "category_loading_indicator"
    timeout: ${timeouts.network}

# Test district selection
- tapOn:
    when:
      visible:
        id: "district_selector"
    id: "district_selector"
- wait: ${timeouts.short}

# Select a district if available
- tapOn:
    when:
      visible:
        text: "Merkez"
    text: "Merkez"
- wait: ${timeouts.short}

# Test category selection
- tapOn:
    when:
      visible:
        id: "category_selector"
    id: "category_selector"
- wait: ${timeouts.short}

# Select a category if available
- tapOn:
    when:
      visible:
        text: "Restoranlar"
    text: "Restoranlar"
- wait: ${timeouts.short}

# Test multiple category selection
- tapOn:
    when:
      visible:
        text: "Kafeler"
    text: "Kafeler"
- wait: ${timeouts.short}

# Take screenshot of selections
- takeScreenshot: "filter_selections_made"

# Test clear filters
- tapOn:
    when:
      visible:
        id: "clear_filters_button"
    id: "clear_filters_button"
- wait: ${timeouts.short}

# Verify filters are cleared
- takeScreenshot: "filters_cleared"

# Make selections again
- tapOn:
    when:
      visible:
        id: "category_selector"
    id: "category_selector"
- wait: ${timeouts.short}

- tapOn:
    when:
      visible:
        text: "Restoranlar"
    text: "Restoranlar"
- wait: ${timeouts.short}

# Apply filter
- tapOn:
    when:
      visible:
        id: "apply_filter_button"
    id: "apply_filter_button"
- wait: ${timeouts.medium}

# Should navigate to filter results
- assertVisible:
    when:
      visible:
        id: "filter_result_view"
    id: "filter_result_view"

# Wait for filter results to load
- wait:
    notVisible:
      id: "loading_indicator"
    timeout: ${timeouts.network}

# Take screenshot of results
- takeScreenshot: "filter_results"

# Test result item interaction
- tapOn:
    when:
      visible:
        id: "filter_result_item"
    id: "filter_result_item"
- wait: ${timeouts.medium}

# If place detail opened
- runFlow:
    when:
      visible:
        id: "place_detail_view"
    file: "./place_detail_interaction.yaml"

# Go back to main view
- tapOn:
    when:
      visible:
        id: "back_button"
    id: "back_button"
- wait: ${timeouts.short}
