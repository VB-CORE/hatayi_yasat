# Feature Flow: Home Page Functionality
# Tests all home page features including loading, categories, filtering

appId: ${APP_ID}
---

# Navigate to home
- runFlow: "../core/app_launch.yaml"
- tapOn:
    text: "Anasayfa"

# Verify home page elements and wait for loading
- assertVisible:
    id: "home_view"
- wait: ${timeouts.medium}

# Wait for any loading indicators to disappear
- wait:
    notVisible:
      id: "loading_indicator"
    timeout: ${timeouts.network}

# Verify main home components
- assertVisible:
    id: "home_categories_area"
- assertVisible:
    id: "home_place_area"

# Test categories section
- takeScreenshot: "home_categories_loaded"

# Test category selection (if available)
- tapOn:
    when:
      visible:
        id: "category_item"
    id: "category_item"
- wait: ${timeouts.medium}

# Verify filter results update
- wait:
    notVisible:
      id: "loading_indicator"
    timeout: ${timeouts.network}
- takeScreenshot: "home_category_filtered"

# Test sorting functionality
- tapOn:
    when:
      visible:
        id: "sort_button"
    id: "sort_button"
- wait: ${timeouts.short}

# Select sort option if sheet opens
- tapOn:
    when:
      visible:
        id: "sort_option_distance"
    id: "sort_option_distance"
- wait: ${timeouts.medium}

# Test city selection functionality
- tapOn:
    when:
      visible:
        id: "city_selector_button"
    id: "city_selector_button"
- wait: ${timeouts.short}

# Verify city selection sheet
- assertVisible:
    when:
      visible:
        id: "regional_city_sheet"
    id: "regional_city_sheet"
- takeScreenshot: "home_city_selection"

# Select a city if available
- tapOn:
    when:
      visible:
        text: "Antakya"
    text: "Antakya"
- wait: ${timeouts.medium}

# Verify city change loading
- wait:
    notVisible:
      id: "loading_indicator"
    timeout: ${timeouts.network}

# Test search functionality
- tapOn:
    when:
      visible:
        id: "search_field"
    id: "search_field"
- inputText: "restaurant"
- wait: ${timeouts.short}
- takeScreenshot: "home_search_input"

# Test search results
- tapOn:
    when:
      visible:
        id: "search_button"
    id: "search_button"
- wait: ${timeouts.medium}

# Wait for search results loading
- wait:
    notVisible:
      id: "loading_indicator"
    timeout: ${timeouts.network}

# Clear search
- clearText:
    when:
      visible:
        id: "search_field"
    id: "search_field"

# Test place card interaction
- tapOn:
    when:
      visible:
        id: "place_card"
    id: "place_card"
- wait: ${timeouts.medium}

# If place detail opened, test and go back
- runFlow:
    when:
      visible:
        id: "place_detail_view"
    file: "./place_detail_interaction.yaml"

# Test filter access
- tapOn:
    when:
      visible:
        id: "filter_button"
    id: "filter_button"
- wait: ${timeouts.medium}

# If filter opened, test and go back
- runFlow:
    when:
      visible:
        id: "filter_view"
    file: "./filter_functionality.yaml"

# Test grid/list view toggle
- tapOn:
    when:
      visible:
        id: "view_toggle_button"
    id: "view_toggle_button"
- wait: ${timeouts.short}
- takeScreenshot: "home_view_toggled"

# Test notifications access
- tapOn:
    when:
      visible:
        id: "notifications_button"
    id: "notifications_button"
- wait: ${timeouts.short}

# If notifications opened, verify and go back
- runFlow:
    when:
      visible:
        id: "notifications_view"
    file: "./notifications_interaction.yaml"
